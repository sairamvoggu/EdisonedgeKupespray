---
 - hosts: centosservers
  #  remote_user: ubuntu
   connection: ssh
   gather_facts: true
   become: yes
  #  become_method: sudo
  #  sudo: no
  # Upgrade all the Ubuntu servers.
  # ansible ubuntu -m apt -a "upgrade=yes update_cache=yes" -b
   tasks:
     - name: Updating apt
       yum:
         upgrade: yes
         update_cache: yes
         # step 1
     - name: updating OS
       yum:
         name: centos
         upgrade: yes
         update_cache: yes
        #  step 2
     - name: Disable SELinux
       selinux:
          state: disabled
        #  step 3 (comment either1)
    #  - name: Reboot systems
    #    reboot:
      #  or 
     - name: Check if reboot is required
       stat:
         path: /var/run/reboot-required
       register: reboot_required_file
       stat: path=/var/run/reboot-required
     - name: Rebooting machine
       shell: sleep 2 && shutdown -r now "Ansible updates triggered"
       async: 1
       poll: 0
       ignore_errors: true
       when: reboot_required_file.stat.exists
     - name: Waiting for the machine to come back
       local_action: wait_for host={{ ansible_host }} state=started port=22 delay=30
       become: no
       when: reboot_required_file.stat.exists
     - name: Waiting for the machine to come back
       local_action: wait_for host={{ ansible_host }} state=started port=22 delay=30
       become: no
       when: reboot_required_file.stat.exists
        # step4
     - name: Disabling firewall and stop services 
       service:
          name: firewalld
          state: stopped
          enabled: False
        # step 5
     - name: Installing epel-release, Ansible, python36 â€“y and pip
       yum:
         name: "{{item}}"
         state: present
       with_items:
           - epel-release
           - Ansible
           - python36
           - pip2
     - name: Install jinja2
       pip2:
         name: jinja2
         state: present
         upgrade: yes
         update_cache: yes
        

      
